CREATE TABLE users ( 
    userid     INTEGER PRIMARY KEY,
    username   VARCHAR2(40) NOT NULL, 
    password   VARCHAR2(40) NOT NULL, 
    balance    FLOAT(49) NOT NULL, 
    admin      INT DEFAULT 0, 
    approval   INT DEFAULT 0,
    CONSTRAINT pk_username UNIQUE (username)
    );

COMMIT;

CREATE TABLE account ( 
    accountNum INTEGER PRIMARY KEY, 
    username VARCHAR2(40) NOT NULL
    );
COMMIT; 
--SEQUENCE TO GENERATE USER_ID
CREATE SEQUENCE USER_SEQ
 MINVALUE 1001
 MAXVALUE 9999
 START WITH 1001
 INCREMENT BY 1 
 CACHE 20; 
--SEQUENCE TO GENERATE BANK_ACCOUNT_ID
 CREATE SEQUENCE ACCOUNT_SEQ
 MINVALUE 4444444
 MAXVALUE 9999999
 START WITH 4444444
 INCREMENT BY 1
 CACHE 20; 
 
--PROCEDURE TO INSERT ACCOUNT_SEQ SEQUENCE
CREATE OR REPLACE PROCEDURE CREATEACCOUNT(username IN VARCHAR2)
AS 
BEGIN 
INSERT INTO account VALUES(ACCOUNT_SEQ.NEXTVAL, username); 
COMMIT; 
END;
/
--PROCEDURE TO INSERT USER_SEQ SEQUENCE
CREATE OR REPLACE PROCEDURE INSERTUSER(username IN VARCHAR2, password IN VARCHAR2, balance IN FLOAT, admin IN INT, approval IN INT)
AS
BEGIN 
INSERT INTO users VALUES(USER_SEQ.NEXTVAL, username, password, balance, admin, approval);
COMMIT;
END;
/
--PROCEDURE TO UPDATE USER
CREATE OR REPLACE PROCEDURE UPDATEUSER(un IN VARCHAR2, pw IN VARCHAR2, bal IN FLOAT, ad IN INT, apr IN INT)
AS
BEGIN 
UPDATE users SET password = pw, balance = bal, admin = ad, approval = apr WHERE username = un; 
COMMIT;
END;
/
--PROCEDURE TO APPROVE USERS
CREATE OR REPLACE PROCEDURE APPROVEUSER(usern IN VARCHAR2)
AS
BEGIN 
UPDATE users SET approval = 1 WHERE username = usern; 
COMMIT;
END;
/
--UPDATE BALANCE
CREATE OR REPLACE PROCEDURE UPDATEBALANCE(usern IN VARCHAR2, bal IN FLOAT)
AS
BEGIN 
UPDATE users SET balance = bal WHERE username = usern; 
COMMIT;
END;
/
--PROCEDURE TO DELETE USERS 
CREATE OR REPLACE PROCEDURE DELETEUSER(usern IN VARCHAR2)
AS
BEGIN 
DELETE FROM users WHERE username = usern; 
COMMIT;
END;
/

--TOTALUSER---
CREATE OR REPLACE FUNCTION TOTALOFUSERS
RETURN NUMBER 
IS
    TOTALUSERS NUMBER := 0;
BEGIN 
    SELECT COUNT(*) 
    INTO TOTALUSERS
    FROM USERS;
    RETURN TOTALUSERS;
COMMIT; 
END;
/

commit; 

SELECT *
FROM USERS;

SELECT * 
FROM account;

TRUNCATE TABLE users;
TRUNCATE TABLE account;






