CREATE TABLE SUPERHERO(
HEROID INTEGER PRIMARY KEY,
HERONAME VARCHAR2(30)
);

CREATE TABLE POWERS (
POWERID INT PRIMARY KEY,
POWERNAME VARCHAR2(30)
);

CREATE SEQUENCE HEROSEQ;
CREATE SEQUENCE POWSEQ;

CREATE OR REPLACE PROCEDURE INSERTSUPERHERO(NAME IN VARCHAR2, PID IN NUMBER)
AS
BEGIN
INSERT INTO SUPERHERO VALUES(HEROSEQ.NEXTVAL, NAME, PID);
COMMIT;
END;
/
EXECUTE INSERTSUPERHERO ('BOOSTER GOLD');
EXECUTE INSERTSUPERHERO ('SPODERMN');
EXECUTE INSERTSUPERHERO ('PROF X');

ALTER TABLE SUPERHERO 
ADD PID NUMBER (5);

ALTER TABLE SUPERHERO
ADD CONSTRAINT FK_PID
FOREIGN KEY (PID) REFERENCES POWERS (POWERID);



CREATE OR REPLACE PROCEDURE INSERTPOWER(POWER IN VARCHAR2)
AS
BEGIN
  INSERT INTO POWERS VALUES(POWSEQ.NEXTVAL,POWER);
EXCEPTION
  WHEN dup_val_on_index
  THEN
    NULL; -- Intentionally ignore duplicates

COMMIT;
END;
/

CREATE OR REPLACE PROCEDURE INSERTSUPERHERO(NAME IN VARCHAR2, PID IN NUMBER)
AS
BEGIN
INSERT INTO SUPERHERO VALUES(HEROSEQ.NEXTVAL, NAME, PID);
COMMIT;
END;
/

CREATE OR REPLACE PROCEDURE INSERTSUPER_AND_POWER(SUPER_NAME IN VARCHAR2, POWER_NAME IN VARCHAR2)

AS
BEGIN
  INSERT INTO POWERS VALUES(POWSEQ.NEXTVAL,POWER_NAME);
EXCEPTION
  WHEN dup_val_on_index
  THEN
    NULL; -- Intentionally ignore duplicates
    INSERT INTO SUPERHERO VALUES(HEROSEQ.NEXTVAL, SUPER_NAME, (SELECT POWERID FROM POWERS WHERE POWERNAME=POWER_NAME));
    COMMIT;
END;
/


CREATE OR REPLACE PROCEDURE DELETESUPER_AND_POWER(SUPER_NAME IN VARCHAR2, POWER_NAME IN VARCHAR2)

AS
BEGIN
UPDATE SUPERHERO
SET PID=0 WHERE PID=((SELECT POWERID FROM POWERS WHERE POWERNAME=POWER_NAME));
DELETE FROM SUPERHERO
WHERE HERONAME =SUPER_NAME;
DELETE FROM POWERS 
WHERE POWERID =(SELECT POWERID FROM POWERS WHERE POWERNAME=POWER_NAME);
COMMIT;
END;
/
EXECUTE DELETESUPER_AND_POWER('IRON MAN','MONEY');

EXECUTE INSERTSUPER_AND_POWER ('IRON MAN','MONEY');



EXECUTE INSERTPOWER ('TIME TRAVEL');
EXECUTE INSERTPOWER ('SUPER STRENGTH');
EXECUTE INSERTPOWER ('SUPER SPEED');
EXECUTE INSERTPOWER ('MONEY');

EXECUTE INSERTSUPERHERO ('BATMAN',5);


EXECUTE INSERTPOWER ('INVULNERABILITY');
EXECUTE INSERTPOWER ('LASER VISION');

DELETE FROM POWERS 
WHERE POWERID =6;

CREATE UNIQUE INDEX power_idx
ON POWERS (POWERNAME);

DELETE FROM SUPERHERO 
WHERE HERONAME ='PROF X';

